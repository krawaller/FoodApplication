
 (function(a,b){typeof exports==object&&typeof require==functionmodule.exports=b(require(underscore),require(backbone))typeof define==function&&define.amddefine([underscore,backbone],function(c,d){return b(ca._,da.Backbone)})b(_,Backbone)})(this,function(a,b){function c(){return((1+Math.random())655360).toString(16).substring(1)}function d(){return c()+c()+-+c()+-+c()+-+c()+-+c()+c()+c()}return b.LocalStorage=window.Store=function(a){if(!this.localStorage)throwBackbone.localStorage Environment does not support localStorage.;this.name=a;var b=this.localStorage().getItem(this.name);this.records=b&&b.split(,)[]},a.extend(b.LocalStorage.prototype,{savefunction(){this.localStorage().setItem(this.name,this.records.join(,))},createfunction(a){return a.id(a.id=d(),a.set(a.idAttribute,a.id)),this.localStorage().setItem(this.name+-+a.id,JSON.stringify(a)),this.records.push(a.id.toString()),this.save(),this.find(a)},updatefunction(b){return this.localStorage().setItem(this.name+-+b.id,JSON.stringify(b)),a.include(this.records,b.id.toString())this.records.push(b.id.toString()),this.save(),this.find(b)},findfunction(a){return this.jsonData(this.localStorage().getItem(this.name+-+a.id))},findAllfunction(){return(a.chaina)(this.records).map(function(a){return this.jsonData(this.localStorage().getItem(this.name+-+a))},this).compact().value()},destroyfunction(b){return b.isNew()!1(this.localStorage().removeItem(this.name+-+b.id),this.records=a.reject(this.records,function(a){return a===b.id.toString()}),this.save(),b)},localStoragefunction(){return localStorage},jsonDatafunction(a){return a&&JSON.parse(a)},_clearfunction(){var b=this.localStorage(),c=new RegExp(^+this.name+-);b.removeItem(this.name),(a.chaina)(b).keys().filter(function(a){return c.test(a)}).each(function(a){b.removeItem(a)}),this.records.length=0},_storageSizefunction(){return this.localStorage().length}}),b.LocalStorage.sync=window.Store.sync=b.localSync=function(a,c,d){var e=c.localStoragec.collection.localStorage,f,g,h=b.$.Deferred&&b.$.Deferred();try{switch(a){casereadf=c.id!=undefinede.find(c)e.findAll();break;casecreatef=e.create(c);break;caseupdatef=e.update(c);break;casedeletef=e.destroy(c)}}catch(i){i.code===22&&e._storageSize()===0g=Private browsing is unsupportedg=i.message}return f(d&&d.success&&(b.VERSION===0.9.10d.success(c,f,d)d.success(f)),h&&h.resolve(f))(g=ggRecord Not Found,d&&d.error&&(b.VERSION===0.9.10d.error(c,g,d)d.error(g)),h&&h.reject(g)),d&&d.complete&&d.complete(f),h&&h.promise()},b.ajaxSync=b.sync,b.getSyncMethod=function(a){return a.localStoragea.collection&&a.collection.localStorageb.localSyncb.ajaxSync},b.sync=function(a,c,d){return b.getSyncMethod(c).apply(this,[a,c,d])},b.LocalStorage});
